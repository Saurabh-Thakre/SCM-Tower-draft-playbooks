- hosts: all
  become: true
  tasks:
 #   - name: Add epel-repo
 #     yum:
 #       name: epel-release
 #      state: present
    - name: Wait for SSH to come up
        wait_for: host= "{{ item.private_ip }}" port=22 delay=60 timeout=320 state=started
        with_items: '{{ ec2_instances.instances }}'
        
    - name: Install Nginx
      yum:
        name: nginx
        state: present
     
    - name: add index.html file
      copy:
        src: /tmp/index.html
        dest: /usr/share/nginx/html/index.html
      
#    - name: allow all access to tcp port 80
#      firewalld:
#        port: 80/tcp
#        zone: public
#        state: enabled

    - name: Start Nginx
      service:
        name: nginx
        state: started
